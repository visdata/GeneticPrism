<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-9FR7K2YVNR"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-9FR7K2YVNR'); </script>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<title>GeneticFlow</title>
        <link rel="icon" href="/src/image/favicon.ico" type="image/x-icon"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css">
        <!-- <link rel="stylesheet" href="/src/css/all.min.css"> -->
		<!-- Bootstrap core CSS -->
		<link href="/src/css/bootstrap.min.css" rel="stylesheet">
		<!-- Custom styles for this template -->
		<link href="/src/css/signin.css" rel="stylesheet">
		<script src="/src/js/jquery.min.js"></script>
	</head>

	<style>
		.question {
			position: relative;
			display: inline-block;
		}

		.question .question-tip {
			visibility: hidden;
			width: 300px;
			background-color: black;
			opacity: 0.8;
			color: #fff;
			text-align: center;
			border-radius: 6px;
			padding: 5px;
			position: absolute;
			z-index: 1;
			bottom: 150%;
			left: 50%;
			margin-left: -150px;
		}

		.question .question-tip::after {
			content: "";
			position: absolute;
			top: 100%;
			left: 50%;
			margin-left: -5px;
			border-width: 5px;
			border-style: solid;
			border-color: black transparent transparent transparent;
		}

		.question:hover .question-tip {
			visibility: visible;
		}

		.digit {
            display: inline-block;
            width: 16px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            border: 0.5px solid black;
            margin: 1px;
            background-color: #f0f0f0;
            border-radius: 4px;
        }
	</style>
    
	<body class="text-center">
		<form class="form-signin">
            <input type="hidden" name="csrfmiddlewaretoken" value="Yse6cgbnpqJr4Xjn1flWIVqE5knZ5Ty44Z0GtTvzdxFypbn46s9aILmj2eTgPCWJ">
			<a href="/"><img class="mb-4" src="/src/image/logo-search.png" alt="" width="420" height="110"></a>
			<br />
			<p id="error" style="color: red">{{ error }}</p>
			<div style="display: flex; width: 60%; margin-left: 20%; margin-bottom: 1%;">
				<!-- <img src="/src/image/search.png" style="order: -1; height: 38px;"> -->
				<div class="card" style="height: 50px; width: 5%; border-radius: 0; border-top-left-radius: 24px; border-bottom-left-radius: 24px; border-right: 0; display: flex; justify-content: center; align-items: center;">
					<svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30">
						<path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
					</svg>
				</div>
	
				<input id="authorInput" name="name" type="text" class="form-control" placeholder="Please enter the scholar name" autofocus="" style="height: 50px; width: 75%; border-left: 0; border-radius: 0;">
				
				<a id="info" class="question btn btn-primary" data-tooltip="Download User Manual" style="background-color: #f5f5f5; height: 50px; width: 5%; border-radius: 0; display: flex; align-items: center; justify-content: center; ">
					<i class="fa-solid fa-circle-info" style="font-size: 22px;"></i>
					<span class="question-tip" style="font-size: 14px;">
						Download User Manual
					</span>
				</a>
				<a id="searchLink" class="btn btn-primary" style="background-color: #f5f5f5; height: 50px; width: 20%; border-radius: 0; border-top-right-radius: 24px; border-bottom-right-radius: 24px; display: flex; align-items: center; justify-content: center; ">
					Scholar Search
				</a>
				
			</div>
			<br />

            <div id="dynamicList" style="display: inline;">
				<div class="category">
					<div class="category-header" onclick="toggleCategory('category1')">Scholars by Research Area</div>
					<div class="category-content" id="category1"></div>
				</div>
				<div class="category">
					<div class="category-header" onclick="toggleCategory('category2')">Scholars by Award</div>
					<div class="category-content" id="category2"></div>
				</div>
				<div class="category" id="domain-category">
					<div class="category-header" onclick="toggleCategory('category3')">Domain Evolution</div>
					<div class="category-content" id="category3"></div>
				</div>
			</div>
			<br />
			<p class="mt-5 text-muted">@ {{ versionID }}<a href="/changelog" style="margin-left: 2em;">ChangeLog</a></p>
			<p style="white-space: pre-wrap; text-align: center"><span id="activeUsers"></span> users and <span id="eventCount"></span> visits since 2023-09.</p>
			<p style="white-space: pre-wrap; text-align: center; margin-bottom: 0%;">Full code & data in <a href="https://github.com/visdata/GeneticPrism">GitHub</a>. Feedback: GitHub issues or <b>geneticflowcontact@gmail.com</b></p>
			<p style="white-space: pre-wrap; text-align: center; margin-bottom: -1%;">See our <a href="reference">arXiv/KDD/VIS/NeurIPS papers</a> for more details.</p>
			<p class="mt-5 text-muted">© 2023-2025<a href="https://beian.miit.gov.cn/" target="_blank" style="margin-left: 2em;">京ICP备2022000473号-2</a></p>
		</form>
	</body>


	<script>
		function scholarSearch(event) {
			event.preventDefault();
			name = $(".form-control").val();
			if (name == '') {
				$("#error").text("Please input the name");
			}
			else {
				console.log(name);
				$("#error").empty();
				window.location.href = "/list?name=" +name;
			}
		}

		function createTitle(data) {
			$("#searchLink").click(scholarSearch);
			$('form').on('submit', function(event) {
				event.preventDefault();
			});
			$("#authorInput").on('keydown', function(event) {
				if (event.key === 'Enter') scholarSearch(event); 
			});
		}

		function isTestEnv() {
			return fetch('/src/.test')
			.then(response => {
				return response.ok;
			})
			.catch(error => {
				return true
			});
		}

		function wrapDigits(number) {
			return String(number).split('').map(digit => `<span class="digit">${digit}</span>`).join('');
		}

		$(function() {
			let activeUsers = {{ activeUsers }};
			let eventCount = {{ eventCount }};
			$('#activeUsers').html(wrapDigits(activeUsers));
            $('#eventCount').html(wrapDigits(eventCount));

			fetch('/src/config.json')
			.then(response => response.json())
			.then(data => {
				let help_link = data['default']['help_link'];
				$("#info").click(function() {
					window.open(help_link);
				});
				delete data['default'];
				isTestEnv().then(isTest => {
					if(!isTest) {
						deleted_keys = Object.keys(data).filter(key => key.startsWith('fellow'));
						deleted_keys.forEach(key => delete data[key]);
						$("#domain-category").hide();
					}
					// console.log(data);
					createTitle(data);
					createList(data);
				})
			})
			.catch(error => console.error('Error:', error));
		});

		function toggleCategory(categoryId) {
			$("#" + categoryId).toggle();
		}
		// icon: https://fontawesome.com/search?o=r&s=solid&f=classic
		// https://www.flaticon.com/free-icons/ai
		function int2str(num) {
			if (num)
				return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
			return '';
		}

		function createList(data) {
			const container1 = $('#category1');
			const container2 = $('#category2');
			const container3 = $('#category3');

			for (const key in data) {
				const item = data[key];
				const info = item['papers'] ? `${int2str(item.authors)} authors / ${int2str(item.topic)} topic<br>${int2str(item.papers)} papers / ${int2str(item.links)} links` : 'unavailable';
				let url = item["type"] == 'Domain'? `index?field=domain&id=${key}` : `search?field=${key}`;
				// 前20个字符
				// let name = item.name.length > 32 ? item.name.substring(0, 29) + '...' : item.name;
				let name = item.name;
				let question = item.question? `<img src="/src/image/question.png" alt="Question Icon" width="20px" height="20px">` : ''
				const link = $('<a>').attr('href', url)
									 .addClass('custom-button')
									 .html(`<i class="${item.icon}"></i> ${name} ${question}<br> 
									 		<p style="font-size: 13px; color: #777; margin: 0;">${info}</p>`)
									//  .attr('title', item.description || item.name);
				const questionDiv = $('<div>')
					.addClass('question')
					.append(link)
					.append($('<span>').addClass('question-tip').text(item.description || item.question || item.name));
				switch (item["type"]) {
					case "CS Subfield": container1.append(questionDiv); break;
					case "Top Scholar": container2.append(questionDiv); break;
					case "Domain": container3.append(questionDiv); break;
				}
			}
		}

	</script>
</html>